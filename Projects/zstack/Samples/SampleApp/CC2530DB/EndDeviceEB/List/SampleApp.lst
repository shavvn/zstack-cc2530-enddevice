###############################################################################
#                                                                             #
# IAR C/C++ Compiler V7.60.1.40026 for 8051             11/Jan/2013  11:06:53 #
# Copyright (C) 2004-2010 IAR Systems AB.                                     #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  E:\Program\MCU\zigbee\CC2530\ZStack-CC2530-2.4.0-1 #
#                          .4.0-1\ZStack-CC2530-2.4.0-1.4.0\Projects\zstack\S #
#                          amples\SampleApp\Source\SampleApp.c                #
#    Command line       =  -f E:\Program\MCU\zigbee\CC2530\ZStack-CC2530-2.4. #
#                          0-1.4.0-1\ZStack-CC2530-2.4.0-1.4.0\Projects\zstac #
#                          k\Samples\SampleApp\CC2530DB\..\..\..\Tools\CC2530 #
#                          DB\f8wEndev.cfg (-DCPU32MHZ -DROOT=__near_func     #
#                          -DMAC_CFG_TX_DATA_MAX=3 -DMAC_CFG_TX_MAX=6         #
#                          -DMAC_CFG_RX_MAX=3) -f E:\Program\MCU\zigbee\CC253 #
#                          0\ZStack-CC2530-2.4.0-1.4.0-1\ZStack-CC2530-2.4.0- #
#                          1.4.0\Projects\zstack\Samples\SampleApp\CC2530DB\. #
#                          .\..\..\Tools\CC2530DB\f8wConfig.cfg (-DZIGBEEPRO  #
#                          -DSECURE=0 -DZG_SECURE_DYNAMIC=0 -DREFLECTOR       #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DLINK_STATUS_JITTER_MASK=0x007F                   #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116                           #
#                          -DZDNWKMGR_MIN_TRANSMISSIONS=20 "-DCONST=const     #
#                          __code" -DGENERIC=__generic                        #
#                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000        #
#                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100)   #
#                          -DREJOIN_POLL_RATE=440 E:\Program\MCU\zigbee\CC253 #
#                          0\ZStack-CC2530-2.4.0-1.4.0-1\ZStack-CC2530-2.4.0- #
#                          1.4.0\Projects\zstack\Samples\SampleApp\Source\Sam #
#                          pleApp.c -D NWK_AUTO_POLL -D ZTOOL_P1 -D MT_TASK   #
#                          -D MT_SYS_FUNC -D MT_ZDO_FUNC -D                   #
#                          LCD_SUPPORTED=DEBUG -lC E:\Program\MCU\zigbee\CC25 #
#                          30\ZStack-CC2530-2.4.0-1.4.0-1\ZStack-CC2530-2.4.0 #
#                          -1.4.0\Projects\zstack\Samples\SampleApp\CC2530DB\ #
#                          EndDeviceEB\List\ -lA E:\Program\MCU\zigbee\CC2530 #
#                          \ZStack-CC2530-2.4.0-1.4.0-1\ZStack-CC2530-2.4.0-1 #
#                          .4.0\Projects\zstack\Samples\SampleApp\CC2530DB\En #
#                          dDeviceEB\List\ --diag_suppress Pe001,Pa010 -o     #
#                          E:\Program\MCU\zigbee\CC2530\ZStack-CC2530-2.4.0-1 #
#                          .4.0-1\ZStack-CC2530-2.4.0-1.4.0\Projects\zstack\S #
#                          amples\SampleApp\CC2530DB\EndDeviceEB\Obj\ -e      #
#                          --require_prototypes --no_code_motion --debug      #
#                          --core=plain --dptr=16,1 --data_model=large        #
#                          --code_model=banked --calling_convention=xdata_ree #
#                          ntrant --place_constants=data_rom                  #
#                          --nr_virtual_regs 16 -I E:\Program\MCU\zigbee\CC25 #
#                          30\ZStack-CC2530-2.4.0-1.4.0-1\ZStack-CC2530-2.4.0 #
#                          -1.4.0\Projects\zstack\Samples\SampleApp\CC2530DB\ #
#                           -I E:\Program\MCU\zigbee\CC2530\ZStack-CC2530-2.4 #
#                          .0-1.4.0-1\ZStack-CC2530-2.4.0-1.4.0\Projects\zsta #
#                          ck\Samples\SampleApp\CC2530DB\..\Source\ -I        #
#                          E:\Program\MCU\zigbee\CC2530\ZStack-CC2530-2.4.0-1 #
#                          .4.0-1\ZStack-CC2530-2.4.0-1.4.0\Projects\zstack\S #
#                          amples\SampleApp\CC2530DB\..\..\..\ZMain\TI2530DB\ #
#                           -I E:\Program\MCU\zigbee\CC2530\ZStack-CC2530-2.4 #
#                          .0-1.4.0-1\ZStack-CC2530-2.4.0-1.4.0\Projects\zsta #
#                          ck\Samples\SampleApp\CC2530DB\..\..\..\..\..\Compo #
#                          nents\hal\include\ -I E:\Program\MCU\zigbee\CC2530 #
#                          \ZStack-CC2530-2.4.0-1.4.0-1\ZStack-CC2530-2.4.0-1 #
#                          .4.0\Projects\zstack\Samples\SampleApp\CC2530DB\.. #
#                          \..\..\..\..\Components\hal\target\CC2530EB\ -I    #
#                          E:\Program\MCU\zigbee\CC2530\ZStack-CC2530-2.4.0-1 #
#                          .4.0-1\ZStack-CC2530-2.4.0-1.4.0\Projects\zstack\S #
#                          amples\SampleApp\CC2530DB\..\..\..\..\..\Component #
#                          s\mac\include\ -I E:\Program\MCU\zigbee\CC2530\ZSt #
#                          ack-CC2530-2.4.0-1.4.0-1\ZStack-CC2530-2.4.0-1.4.0 #
#                          \Projects\zstack\Samples\SampleApp\CC2530DB\..\..\ #
#                          ..\..\..\Components\mac\high_level\ -I             #
#                          E:\Program\MCU\zigbee\CC2530\ZStack-CC2530-2.4.0-1 #
#                          .4.0-1\ZStack-CC2530-2.4.0-1.4.0\Projects\zstack\S #
#                          amples\SampleApp\CC2530DB\..\..\..\..\..\Component #
#                          s\mac\low_level\srf04\ -I                          #
#                          E:\Program\MCU\zigbee\CC2530\ZStack-CC2530-2.4.0-1 #
#                          .4.0-1\ZStack-CC2530-2.4.0-1.4.0\Projects\zstack\S #
#                          amples\SampleApp\CC2530DB\..\..\..\..\..\Component #
#                          s\mac\low_level\srf04\single_chip\ -I              #
#                          E:\Program\MCU\zigbee\CC2530\ZStack-CC2530-2.4.0-1 #
#                          .4.0-1\ZStack-CC2530-2.4.0-1.4.0\Projects\zstack\S #
#                          amples\SampleApp\CC2530DB\..\..\..\..\..\Component #
#                          s\mt\ -I E:\Program\MCU\zigbee\CC2530\ZStack-CC253 #
#                          0-2.4.0-1.4.0-1\ZStack-CC2530-2.4.0-1.4.0\Projects #
#                          \zstack\Samples\SampleApp\CC2530DB\..\..\..\..\..\ #
#                          Components\osal\include\ -I                        #
#                          E:\Program\MCU\zigbee\CC2530\ZStack-CC2530-2.4.0-1 #
#                          .4.0-1\ZStack-CC2530-2.4.0-1.4.0\Projects\zstack\S #
#                          amples\SampleApp\CC2530DB\..\..\..\..\..\Component #
#                          s\osal\mcu\ccsoc\ -I E:\Program\MCU\zigbee\CC2530\ #
#                          ZStack-CC2530-2.4.0-1.4.0-1\ZStack-CC2530-2.4.0-1. #
#                          4.0\Projects\zstack\Samples\SampleApp\CC2530DB\..\ #
#                          ..\..\..\..\Components\services\saddr\ -I          #
#                          E:\Program\MCU\zigbee\CC2530\ZStack-CC2530-2.4.0-1 #
#                          .4.0-1\ZStack-CC2530-2.4.0-1.4.0\Projects\zstack\S #
#                          amples\SampleApp\CC2530DB\..\..\..\..\..\Component #
#                          s\services\sdata\ -I E:\Program\MCU\zigbee\CC2530\ #
#                          ZStack-CC2530-2.4.0-1.4.0-1\ZStack-CC2530-2.4.0-1. #
#                          4.0\Projects\zstack\Samples\SampleApp\CC2530DB\..\ #
#                          ..\..\..\..\Components\stack\af\ -I                #
#                          E:\Program\MCU\zigbee\CC2530\ZStack-CC2530-2.4.0-1 #
#                          .4.0-1\ZStack-CC2530-2.4.0-1.4.0\Projects\zstack\S #
#                          amples\SampleApp\CC2530DB\..\..\..\..\..\Component #
#                          s\stack\nwk\ -I E:\Program\MCU\zigbee\CC2530\ZStac #
#                          k-CC2530-2.4.0-1.4.0-1\ZStack-CC2530-2.4.0-1.4.0\P #
#                          rojects\zstack\Samples\SampleApp\CC2530DB\..\..\.. #
#                          \..\..\Components\stack\sapi\ -I                   #
#                          E:\Program\MCU\zigbee\CC2530\ZStack-CC2530-2.4.0-1 #
#                          .4.0-1\ZStack-CC2530-2.4.0-1.4.0\Projects\zstack\S #
#                          amples\SampleApp\CC2530DB\..\..\..\..\..\Component #
#                          s\stack\sec\ -I E:\Program\MCU\zigbee\CC2530\ZStac #
#                          k-CC2530-2.4.0-1.4.0-1\ZStack-CC2530-2.4.0-1.4.0\P #
#                          rojects\zstack\Samples\SampleApp\CC2530DB\..\..\.. #
#                          \..\..\Components\stack\sys\ -I                    #
#                          E:\Program\MCU\zigbee\CC2530\ZStack-CC2530-2.4.0-1 #
#                          .4.0-1\ZStack-CC2530-2.4.0-1.4.0\Projects\zstack\S #
#                          amples\SampleApp\CC2530DB\..\..\..\..\..\Component #
#                          s\stack\zdo\ -I E:\Program\MCU\zigbee\CC2530\ZStac #
#                          k-CC2530-2.4.0-1.4.0-1\ZStack-CC2530-2.4.0-1.4.0\P #
#                          rojects\zstack\Samples\SampleApp\CC2530DB\..\..\.. #
#                          \..\..\Components\zmac\ -I                         #
#                          E:\Program\MCU\zigbee\CC2530\ZStack-CC2530-2.4.0-1 #
#                          .4.0-1\ZStack-CC2530-2.4.0-1.4.0\Projects\zstack\S #
#                          amples\SampleApp\CC2530DB\..\..\..\..\..\Component #
#                          s\zmac\f8w\ -I "D:\Program Files\IAR               #
#                          Systems\Embedded Workbench 5.4\8051\INC\" -I       #
#                          "D:\Program Files\IAR Systems\Embedded Workbench   #
#                          5.4\8051\INC\CLIB\" -Ohz                           #
#    List file          =  E:\Program\MCU\zigbee\CC2530\ZStack-CC2530-2.4.0-1 #
#                          .4.0-1\ZStack-CC2530-2.4.0-1.4.0\Projects\zstack\S #
#                          amples\SampleApp\CC2530DB\EndDeviceEB\List\SampleA #
#                          pp.lst                                             #
#    Object file        =  E:\Program\MCU\zigbee\CC2530\ZStack-CC2530-2.4.0-1 #
#                          .4.0-1\ZStack-CC2530-2.4.0-1.4.0\Projects\zstack\S #
#                          amples\SampleApp\CC2530DB\EndDeviceEB\Obj\SampleAp #
#                          p.r51                                              #
#                                                                             #
#                                                                             #
###############################################################################

E:\Program\MCU\zigbee\CC2530\ZStack-CC2530-2.4.0-1.4.0-1\ZStack-CC2530-2.4.0-1.4.0\Projects\zstack\Samples\SampleApp\Source\SampleApp.c
      1          /**************************************************************************************************
      2            Filename:       SampleApp.c
      3            Revised:        $Date: 2009-03-18 15:56:27 -0700 (Wed, 18 Mar 2009) $
      4            Revision:       $Revision: 19453 $
      5          
      6            Description:    Sample Application (no Profile).
      7          
      8          
      9            Copyright 2007 Texas Instruments Incorporated. All rights reserved.
     10          
     11            IMPORTANT: Your use of this Software is limited to those specific rights
     12            granted under the terms of a software license agreement between the user
     13            who downloaded the software, his/her employer (which must be your employer)
     14            and Texas Instruments Incorporated (the "License").  You may not use this
     15            Software unless you agree to abide by the terms of the License. The License
     16            limits your use, and you acknowledge, that the Software may not be modified,
     17            copied or distributed unless embedded on a Texas Instruments microcontroller
     18            or used solely and exclusively in conjunction with a Texas Instruments radio
     19            frequency transceiver, which is integrated into your product.  Other than for
     20            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     21            works of, modify, distribute, perform, display or sell this Software and/or
     22            its documentation for any purpose.
     23          
     24            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     25            PROVIDED “AS IS?WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     26            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     27            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     28            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     29            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     30            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     31            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     32            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     33            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     34            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     35          
     36            Should you have any questions regarding your right to use this Software,
     37            contact Texas Instruments Incorporated at www.TI.com.
     38          **************************************************************************************************/
     39          
     40          /*********************************************************************
     41            This application isn't intended to do anything useful, it is
     42            intended to be a simple example of an application's structure.
     43          
     44            This application sends it's messages either as broadcast or
     45            broadcast filtered group messages.  The other (more normal)
     46            message addressing is unicast.  Most of the other sample
     47            applications are written to support the unicast message model.
     48          
     49            Key control:
     50              SW1:  Sends a flash command to all devices in Group 1.
     51              SW2:  Adds/Removes (toggles) this device in and out
     52                    of Group 1.  This will enable and disable the
     53                    reception of the flash command.
     54          *********************************************************************/
     55          
     56          /*********************************************************************
     57           * INCLUDES
     58           */
     59          #include "OSAL.h"
     60          #include "ZGlobals.h"
     61          #include "AF.h"
     62          #include "aps_groups.h"
     63          #include "ZDApp.h"
     64          
     65          #include "SampleApp.h"
     66          #include "SampleAppHw.h"
     67          
     68          #include "OnBoard.h"
     69          
     70          /* HAL */
     71          #include "hal_lcd.h"
     72          #include "hal_led.h"
     73          #include "hal_key.h"
     74          #include "MT_UART.h"
     75          #include "MT_APP.h"
     76          #include "stdio.h"
     77          
     78          /*********************************************************************
     79           * MACROS
     80           */
     81          
     82          /*********************************************************************
     83           * CONSTANTS
     84           */
     85          
     86          /*********************************************************************
     87           * TYPEDEFS
     88           */
     89          
     90          /*********************************************************************
     91           * GLOBAL VARIABLES
     92           */
     93          
     94          // This list should be filled with Application specific Cluster IDs.

   \                                 In  segment XDATA_ROM_C, align 1
     95          const cId_t SampleApp_ClusterList[SAMPLEAPP_MAX_CLUSTERS] =
   \                     SampleApp_ClusterList:
   \   000000   01000200     DW 1, 2
     96          {
     97            SAMPLEAPP_PERIODIC_CLUSTERID,
     98            SAMPLEAPP_FLASH_CLUSTERID
     99          };
    100          

   \                                 In  segment XDATA_ROM_C, align 1
    101          const SimpleDescriptionFormat_t SampleApp_SimpleDesc =
   \                     SampleApp_SimpleDesc:
   \   000000   14           DB 20
   \   000001   080F0100     DW 3848, 1
   \   000005   0002         DB 0, 2
   \   000007   ....         DW SampleApp_ClusterList
   \   000009   02           DB 2
   \   00000A   ....         DW SampleApp_ClusterList
    102          {
    103            SAMPLEAPP_ENDPOINT,              //  int Endpoint;
    104            SAMPLEAPP_PROFID,                //  uint16 AppProfId[2];
    105            SAMPLEAPP_DEVICEID,              //  uint16 AppDeviceId[2];
    106            SAMPLEAPP_DEVICE_VERSION,        //  int   AppDevVer:4;
    107            SAMPLEAPP_FLAGS,                 //  int   AppFlags:4;
    108            SAMPLEAPP_MAX_CLUSTERS,          //  uint8  AppNumInClusters;
    109            (cId_t *)SampleApp_ClusterList,  //  uint8 *pAppInClusterList;
    110            SAMPLEAPP_MAX_CLUSTERS,          //  uint8  AppNumInClusters;
    111            (cId_t *)SampleApp_ClusterList   //  uint8 *pAppInClusterList;
    112          };
    113          
    114          // This is the Endpoint/Interface description.  It is defined here, but
    115          // filled-in in SampleApp_Init().  Another way to go would be to fill
    116          // in the structure here and make it a "const" (in code space).  The
    117          // way it's defined in this sample app it is define in RAM.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    118          endPointDesc_t SampleApp_epDesc;
   \                     SampleApp_epDesc:
   \   000000                DS 6
   \   000006                REQUIRE __INIT_XDATA_Z
    119          
    120          /*********************************************************************
    121           * EXTERNAL VARIABLES
    122           */
    123          
    124          /*********************************************************************
    125           * EXTERNAL FUNCTIONS
    126           */
    127          
    128          /*********************************************************************
    129           * LOCAL VARIABLES
    130           */

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    131          uint8 SampleApp_TaskID;   // Task ID for internal task/event processing
   \                     SampleApp_TaskID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    132                                    // This variable will be received when
    133                                    // SampleApp_Init() is called.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    134          devStates_t SampleApp_NwkState;
   \                     SampleApp_NwkState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    135          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    136          uint8 SampleApp_TransID;  // This is the unique message ID (counter)
   \                     SampleApp_TransID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    137          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    138          afAddrType_t SampleApp_Periodic_DstAddr;
   \                     SampleApp_Periodic_DstAddr:
   \   000000                DS 12
   \   00000C                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    139          afAddrType_t SampleApp_Flash_DstAddr;
   \                     SampleApp_Flash_DstAddr:
   \   000000                DS 12
   \   00000C                REQUIRE __INIT_XDATA_Z
    140          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    141          aps_Group_t SampleApp_Group;
   \                     SampleApp_Group:
   \   000000                DS 18
   \   000012                REQUIRE __INIT_XDATA_Z
    142          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    143          uint8 SampleAppPeriodicCounter = 0;
   \                     SampleAppPeriodicCounter:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    144          uint8 SampleAppFlashCounter = 0;
   \                     SampleAppFlashCounter:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    145          
    146          /*********************************************************************
    147           * LOCAL FUNCTIONS
    148           */
    149          void SampleApp_HandleKeys( uint8 shift, uint8 keys );
    150          void SampleApp_MessageMSGCB( afIncomingMSGPacket_t *pckt );
    151          void SampleApp_SendPeriodicMessage( void );
    152          void SampleApp_SendFlashMessage( uint16 flashTime );
    153          
    154          /*********************************************************************
    155           * NETWORK LAYER CALLBACKS
    156           */
    157          
    158          /*********************************************************************
    159           * PUBLIC FUNCTIONS
    160           */
    161          
    162          /*********************************************************************
    163           * @fn      SampleApp_Init
    164           *
    165           * @brief   Initialization function for the Generic App Task.
    166           *          This is called during initialization and should contain
    167           *          any application specific initialization (ie. hardware
    168           *          initialization/setup, table initialization, power up
    169           *          notificaiton ... ).
    170           *
    171           * @param   task_id - the ID assigned by OSAL.  This ID should be
    172           *                    used to send messages and set timers.
    173           *
    174           * @return  none
    175           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    176          void SampleApp_Init( uint8 task_id )
   \                     SampleApp_Init:
    177          {
   \   000000   74F5         MOV     A,#-0xb
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 11
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
    178            SampleApp_TaskID = task_id;
   \   000006   90....       MOV     DPTR,#SampleApp_TaskID
   \   000009   F0           MOVX    @DPTR,A
    179            SampleApp_NwkState = DEV_INIT;
   \   00000A   7401         MOV     A,#0x1
   \   00000C   90....       MOV     DPTR,#SampleApp_NwkState
   \   00000F   F0           MOVX    @DPTR,A
    180            SampleApp_TransID = 0;
   \   000010   E4           CLR     A
   \   000011   90....       MOV     DPTR,#SampleApp_TransID
   \   000014   F0           MOVX    @DPTR,A
    181          
    182            HalUARTInit();
   \   000015                ; Setup parameters for call to function HalUARTInit
   \   000015   12....       LCALL   ??HalUARTInit?relay
    183            printf("\r\n HEELO Waveshare\r\n"); 
   \   000018                ; Setup parameters for call to function printf
   \   000018   7A..         MOV     R2,#(`?<Constant "\\r\\n HEELO Waveshare\\r\\n">` & 0xff)
   \   00001A   7B..         MOV     R3,#((`?<Constant "\\r\\n HEELO Waveshare\\r\\n">` >> 8) & 0xff)
   \   00001C   12....       LCALL   ??printf?relay
    184            
    185            // Device hardware initialization can be added here or in main() (Zmain.c).
    186            // If the hardware is application specific - add it here.
    187            // If the hardware is other parts of the device add it in main().
    188          
    189          // #if defined ( BUILD_ALL_DEVICES )
    190          //  // The "Demo" target is setup to have BUILD_ALL_DEVICES and HOLD_AUTO_START
    191          //  // We are looking at a jumper (defined in SampleAppHw.c) to be jumpered
    192          //  // together - if they are - we will start up a coordinator. Otherwise,
    193          //  // the device will start as a router.
    194          //  if ( readCoordinatorJumper() )
    195          //    zgDeviceLogicalType = ZG_DEVICETYPE_COORDINATOR;
    196          //  else
    197          //    zgDeviceLogicalType = ZG_DEVICETYPE_ROUTER;
    198          //#endif // BUILD_ALL_DEVICES
    199          
    200          #if defined ( HOLD_AUTO_START )
    201            // HOLD_AUTO_START is a compile option that will surpress ZDApp
    202            //  from starting the device and wait for the application to
    203            //  start the device.
    204            ZDOInitDevice(0);
    205          #endif
    206          
    207            
    208            
    209          
    210            
    211            // Setup for the periodic message's destination address
    212            // Broadcast to everyone
    213            SampleApp_Periodic_DstAddr.addrMode = (afAddrMode_t)AddrBroadcast;
   \   00001F   740F         MOV     A,#0xf
   \   000021   90....       MOV     DPTR,#(SampleApp_Periodic_DstAddr + 8)
   \   000024   F0           MOVX    @DPTR,A
    214            SampleApp_Periodic_DstAddr.endPoint = SAMPLEAPP_ENDPOINT;
   \   000025   7414         MOV     A,#0x14
   \   000027   90....       MOV     DPTR,#(SampleApp_Periodic_DstAddr + 9)
   \   00002A   F0           MOVX    @DPTR,A
    215            SampleApp_Periodic_DstAddr.addr.shortAddr = 0xFFFF;
   \   00002B   90....       MOV     DPTR,#SampleApp_Periodic_DstAddr
   \   00002E   74FF         MOV     A,#-0x1
   \   000030   F0           MOVX    @DPTR,A
   \   000031   A3           INC     DPTR
   \   000032   F0           MOVX    @DPTR,A
    216          
    217            // Setup for the flash command's destination address - Group 1
    218            SampleApp_Flash_DstAddr.addrMode = (afAddrMode_t)afAddrGroup;
   \   000033   7401         MOV     A,#0x1
   \   000035   90....       MOV     DPTR,#(SampleApp_Flash_DstAddr + 8)
   \   000038   F0           MOVX    @DPTR,A
    219            SampleApp_Flash_DstAddr.endPoint = SAMPLEAPP_ENDPOINT;
   \   000039   7414         MOV     A,#0x14
   \   00003B   90....       MOV     DPTR,#(SampleApp_Flash_DstAddr + 9)
   \   00003E   F0           MOVX    @DPTR,A
    220            SampleApp_Flash_DstAddr.addr.shortAddr = SAMPLEAPP_FLASH_GROUP;
   \   00003F   90....       MOV     DPTR,#SampleApp_Flash_DstAddr
   \   000042   7401         MOV     A,#0x1
   \   000044   F0           MOVX    @DPTR,A
   \   000045   A3           INC     DPTR
   \   000046   E4           CLR     A
   \   000047   F0           MOVX    @DPTR,A
    221          
    222            // Fill out the endpoint description.
    223            SampleApp_epDesc.endPoint = SAMPLEAPP_ENDPOINT;
   \   000048   7414         MOV     A,#0x14
   \   00004A   90....       MOV     DPTR,#SampleApp_epDesc
   \   00004D   F0           MOVX    @DPTR,A
    224            SampleApp_epDesc.task_id = &SampleApp_TaskID;
   \   00004E   90....       MOV     DPTR,#(SampleApp_epDesc + 1)
   \   000051   74..         MOV     A,#(SampleApp_TaskID & 0xff)
   \   000053   F0           MOVX    @DPTR,A
   \   000054   A3           INC     DPTR
   \   000055   74..         MOV     A,#((SampleApp_TaskID >> 8) & 0xff)
   \   000057   F0           MOVX    @DPTR,A
    225            SampleApp_epDesc.simpleDesc
    226                      = (SimpleDescriptionFormat_t *)&SampleApp_SimpleDesc;
   \   000058   90....       MOV     DPTR,#(SampleApp_epDesc + 3)
   \   00005B   74..         MOV     A,#(SampleApp_SimpleDesc & 0xff)
   \   00005D   F0           MOVX    @DPTR,A
   \   00005E   A3           INC     DPTR
   \   00005F   74..         MOV     A,#((SampleApp_SimpleDesc >> 8) & 0xff)
   \   000061   F0           MOVX    @DPTR,A
    227            SampleApp_epDesc.latencyReq = noLatencyReqs;
   \   000062   E4           CLR     A
   \   000063   90....       MOV     DPTR,#(SampleApp_epDesc + 5)
   \   000066   F0           MOVX    @DPTR,A
    228          
    229            // Register the endpoint description with the AF
    230            afRegister( &SampleApp_epDesc );
   \   000067                ; Setup parameters for call to function afRegister
   \   000067   7A..         MOV     R2,#(SampleApp_epDesc & 0xff)
   \   000069   7B..         MOV     R3,#((SampleApp_epDesc >> 8) & 0xff)
   \   00006B   12....       LCALL   ??afRegister?relay
    231          
    232            // Register for all key events - This app will handle all key events
    233            RegisterForKeys( SampleApp_TaskID );
   \   00006E                ; Setup parameters for call to function RegisterForKeys
   \   00006E   90....       MOV     DPTR,#SampleApp_TaskID
   \   000071   E0           MOVX    A,@DPTR
   \   000072   F9           MOV     R1,A
   \   000073   12....       LCALL   ??RegisterForKeys?relay
    234          
    235            // By default, all devices start out in Group 1
    236            SampleApp_Group.ID = 0x0001;
   \   000076   90....       MOV     DPTR,#SampleApp_Group
   \   000079   7401         MOV     A,#0x1
   \   00007B   F0           MOVX    @DPTR,A
   \   00007C   A3           INC     DPTR
   \   00007D   E4           CLR     A
   \   00007E   F0           MOVX    @DPTR,A
    237            osal_memcpy( SampleApp_Group.name, "Group 1", 7  );
   \   00007F                ; Setup parameters for call to function osal_memcpy
   \   00007F   75....       MOV     ?V0 + 0,#(`?<Constant "Group 1">` & 0xff)
   \   000082   75....       MOV     ?V0 + 1,#((`?<Constant "Group 1">` >> 8) & 0xff)
   \   000085   F5..         MOV     ?V0 + 2,A
   \   000087   78..         MOV     R0,#?V0 + 0
   \   000089   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   00008C   7C07         MOV     R4,#0x7
   \   00008E   7D00         MOV     R5,#0x0
   \   000090   7A..         MOV     R2,#((SampleApp_Group + 2) & 0xff)
   \   000092   7B..         MOV     R3,#(((SampleApp_Group + 2) >> 8) & 0xff)
   \   000094   12....       LCALL   ??osal_memcpy?relay
   \   000097   7403         MOV     A,#0x3
   \   000099   12....       LCALL   ?DEALLOC_XSTACK8
    238            aps_AddGroup( SAMPLEAPP_ENDPOINT, &SampleApp_Group );
   \   00009C                ; Setup parameters for call to function aps_AddGroup
   \   00009C   7A..         MOV     R2,#(SampleApp_Group & 0xff)
   \   00009E   7B..         MOV     R3,#((SampleApp_Group >> 8) & 0xff)
   \   0000A0   7914         MOV     R1,#0x14
   \   0000A2   12....       LCALL   ??aps_AddGroup?relay
    239          
    240          #if defined ( LCD_SUPPORTED )
    241            HalLcdWriteString( "SampleApp", HAL_LCD_LINE_1 );
   \   0000A5                ; Setup parameters for call to function HalLcdWriteString
   \   0000A5   7901         MOV     R1,#0x1
   \   0000A7   7A..         MOV     R2,#(`?<Constant "SampleApp">` & 0xff)
   \   0000A9   7B..         MOV     R3,#((`?<Constant "SampleApp">` >> 8) & 0xff)
   \   0000AB   12....       LCALL   ??HalLcdWriteString?relay
    242          #endif
    243          }
   \   0000AE   7F03         MOV     R7,#0x3
   \   0000B0   02....       LJMP    ?BANKED_LEAVE_XDATA
    244          
    245          /*********************************************************************
    246           * @fn      SampleApp_ProcessEvent
    247           *
    248           * @brief   Generic Application Task event processor.  This function
    249           *          is called to process all events for the task.  Events
    250           *          include timers, messages and any other user defined events.
    251           *
    252           * @param   task_id  - The OSAL assigned task ID.
    253           * @param   events - events to process.  This is a bit map and can
    254           *                   contain more than one event.
    255           *
    256           * @return  none
    257           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    258          uint16 SampleApp_ProcessEvent( uint8 task_id, uint16 events )
   \                     SampleApp_ProcessEvent:
    259          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    260            afIncomingMSGPacket_t *MSGpkt;
    261            (void)task_id;  // Intentionally unreferenced parameter
    262          
    263            if ( events & SYS_EVENT_MSG )
   \   000009   7480         MOV     A,#-0x80
   \   00000B   5F           ANL     A,R7
   \   00000C   F9           MOV     R1,A
   \   00000D   E4           CLR     A
   \   00000E   7001         JNZ     ??SampleApp_ProcessEvent_0
   \   000010   E9           MOV     A,R1
   \                     ??SampleApp_ProcessEvent_0:
   \   000011   7003         JNZ     $+5
   \   000013   02....       LJMP    ??SampleApp_ProcessEvent_1 & 0xFFFF
    264            {
    265              MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( SampleApp_TaskID );
   \   000016                ; Setup parameters for call to function osal_msg_receive
   \   000016   801F         SJMP    ??SampleApp_ProcessEvent_2
    266              while ( MSGpkt )
    267              {
    268                switch ( MSGpkt->hdr.event )
    269                {
    270                  // Received when a key is pressed
    271                  case KEY_CHANGE:
    272                    SampleApp_HandleKeys( ((keyChange_t *)MSGpkt)->state, ((keyChange_t *)MSGpkt)->keys );
   \                     ??SampleApp_ProcessEvent_3:
   \   000018                ; Setup parameters for call to function SampleApp_HandleKeys
   \   000018   85..82       MOV     DPL,?V0 + 0
   \   00001B   85..83       MOV     DPH,?V0 + 1
   \   00001E   A3           INC     DPTR
   \   00001F   A3           INC     DPTR
   \   000020   A3           INC     DPTR
   \   000021   E0           MOVX    A,@DPTR
   \   000022   FA           MOV     R2,A
   \   000023   85..82       MOV     DPL,?V0 + 0
   \   000026   85..83       MOV     DPH,?V0 + 1
   \   000029   A3           INC     DPTR
   \   00002A   A3           INC     DPTR
   \   00002B   E0           MOVX    A,@DPTR
   \   00002C   F9           MOV     R1,A
   \   00002D   12....       LCALL   ??SampleApp_HandleKeys?relay
    273                    break;
    274          
    275                  // Received when a messages is received (OTA) for this endpoint
    276                  case AF_INCOMING_MSG_CMD:
    277                    SampleApp_MessageMSGCB( MSGpkt );
    278                    break;
    279          
    280                  // Received whenever the device changes state in the network
    281                  case ZDO_STATE_CHANGE:
    282                    SampleApp_NwkState = (devStates_t)(MSGpkt->hdr.status);
    283                    if ( (SampleApp_NwkState == DEV_ZB_COORD)
    284                        || (SampleApp_NwkState == DEV_ROUTER)
    285                        || (SampleApp_NwkState == DEV_END_DEVICE) )
    286                    {
    287                      // Start sending the periodic message in a regular interval.
    288                      osal_start_timerEx( SampleApp_TaskID,
    289                                        SAMPLEAPP_SEND_PERIODIC_MSG_EVT,
    290                                        SAMPLEAPP_SEND_PERIODIC_MSG_TIMEOUT );
    291                    }
    292                    else
    293                    {
    294                      // Device is no longer in the network
    295                    }
    296                    break;
    297          
    298                  default:
    299                    break;
    300                }
    301          
    302                // Release the memory
    303                osal_msg_deallocate( (uint8 *)MSGpkt );
   \                     ??SampleApp_ProcessEvent_4:
   \   000030                ; Setup parameters for call to function osal_msg_deallocate
   \   000030   AA..         MOV     R2,?V0 + 0
   \   000032   AB..         MOV     R3,?V0 + 1
   \   000034   12....       LCALL   ??osal_msg_deallocate?relay
    304          
    305                // Next - if one is available
    306                MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( SampleApp_TaskID );
   \   000037                ; Setup parameters for call to function osal_msg_receive
   \                     ??SampleApp_ProcessEvent_2:
   \   000037   90....       MOV     DPTR,#SampleApp_TaskID
   \   00003A   E0           MOVX    A,@DPTR
   \   00003B   F9           MOV     R1,A
   \   00003C   12....       LCALL   ??osal_msg_receive?relay
   \   00003F   8A..         MOV     ?V0 + 0,R2
   \   000041   8B..         MOV     ?V0 + 1,R3
   \   000043   E5..         MOV     A,?V0 + 0
   \   000045   7002         JNZ     ??SampleApp_ProcessEvent_5
   \   000047   E5..         MOV     A,?V0 + 1
   \                     ??SampleApp_ProcessEvent_5:
   \   000049   604C         JZ      ??SampleApp_ProcessEvent_6
   \   00004B   85..82       MOV     DPL,?V0 + 0
   \   00004E   85..83       MOV     DPH,?V0 + 1
   \   000051   E0           MOVX    A,@DPTR
   \   000052   12....       LCALL   ?UC_SWITCH_SPARSE
   \                     `?<Jumptable for SampleApp_ProcessEvent>_0`:
   \   000055   00           DB        0
   \   000056   03           DB        3
   \   000057   1A           DB        26
   \   000058   ....         DW        ??SampleApp_ProcessEvent_7
   \   00005A   C0           DB        192
   \   00005B   ....         DW        ??SampleApp_ProcessEvent_3
   \   00005D   D1           DB        209
   \   00005E   ....         DW        ??SampleApp_ProcessEvent_8
   \   000060   ....         DW        ??SampleApp_ProcessEvent_4
   \                     ??SampleApp_ProcessEvent_7:
   \   000062                ; Setup parameters for call to function SampleApp_MessageMSGCB
   \   000062   AA..         MOV     R2,?V0 + 0
   \   000064   AB..         MOV     R3,?V0 + 1
   \   000066   12....       LCALL   ??SampleApp_MessageMSGCB?relay
   \   000069   80C5         SJMP    ??SampleApp_ProcessEvent_4
   \                     ??SampleApp_ProcessEvent_8:
   \   00006B   85..82       MOV     DPL,?V0 + 0
   \   00006E   85..83       MOV     DPH,?V0 + 1
   \   000071   A3           INC     DPTR
   \   000072   E0           MOVX    A,@DPTR
   \   000073   90....       MOV     DPTR,#SampleApp_NwkState
   \   000076   F0           MOVX    @DPTR,A
   \   000077   6409         XRL     A,#0x9
   \   000079   600A         JZ      ??SampleApp_ProcessEvent_9
   \   00007B   E0           MOVX    A,@DPTR
   \   00007C   6407         XRL     A,#0x7
   \   00007E   6005         JZ      ??SampleApp_ProcessEvent_9
   \   000080   E0           MOVX    A,@DPTR
   \   000081   6406         XRL     A,#0x6
   \   000083   70AB         JNZ     ??SampleApp_ProcessEvent_4
   \                     ??SampleApp_ProcessEvent_9:
   \   000085                ; Setup parameters for call to function osal_start_timerEx
   \   000085   7C88         MOV     R4,#-0x78
   \   000087   7D13         MOV     R5,#0x13
   \   000089   7A01         MOV     R2,#0x1
   \   00008B   7B00         MOV     R3,#0x0
   \   00008D   90....       MOV     DPTR,#SampleApp_TaskID
   \   000090   E0           MOVX    A,@DPTR
   \   000091   F9           MOV     R1,A
   \   000092   12....       LCALL   ??osal_start_timerEx?relay
   \   000095   8099         SJMP    ??SampleApp_ProcessEvent_4
    307              }
    308          
    309              // return unprocessed events
    310              return (events ^ SYS_EVENT_MSG);
   \                     ??SampleApp_ProcessEvent_6:
   \   000097   EE           MOV     A,R6
   \   000098   FA           MOV     R2,A
   \   000099   7480         MOV     A,#-0x80
   \   00009B   6F           XRL     A,R7
   \                     ??SampleApp_ProcessEvent_10:
   \   00009C   FB           MOV     R3,A
   \   00009D   802F         SJMP    ??SampleApp_ProcessEvent_11
    311            }
    312          
    313            // Send a message out - This event is generated by a timer
    314            //  (setup in SampleApp_Init()).
    315            if ( events & SAMPLEAPP_SEND_PERIODIC_MSG_EVT )
   \                     ??SampleApp_ProcessEvent_1:
   \   00009F   EE           MOV     A,R6
   \   0000A0   A2E0         MOV     C,0xE0 /* A   */.0
   \   0000A2   5026         JNC     ??SampleApp_ProcessEvent_12
    316            {
    317              // Send the periodic message
    318              SampleApp_SendPeriodicMessage();
   \   0000A4                ; Setup parameters for call to function SampleApp_SendPeriodicMessage
   \   0000A4   12....       LCALL   ??SampleApp_SendPeriodicMessage?relay
    319          
    320              // Setup to send message again in normal period (+ a little jitter)
    321              osal_start_timerEx( SampleApp_TaskID, SAMPLEAPP_SEND_PERIODIC_MSG_EVT,
    322                  (SAMPLEAPP_SEND_PERIODIC_MSG_TIMEOUT + (osal_rand() & 0x00FF)) );
   \   0000A7                ; Setup parameters for call to function osal_rand
   \   0000A7   12....       LCALL   ??osal_rand?relay
   \   0000AA   8A..         MOV     ?V0 + 0,R2
   \   0000AC   A8..         MOV     R0,?V0 + 0
   \   0000AE                ; Setup parameters for call to function osal_start_timerEx
   \   0000AE   7488         MOV     A,#-0x78
   \   0000B0   28           ADD     A,R0
   \   0000B1   FC           MOV     R4,A
   \   0000B2   7413         MOV     A,#0x13
   \   0000B4   3400         ADDC    A,#0x0
   \   0000B6   FD           MOV     R5,A
   \   0000B7   7A01         MOV     R2,#0x1
   \   0000B9   7B00         MOV     R3,#0x0
   \   0000BB   90....       MOV     DPTR,#SampleApp_TaskID
   \   0000BE   E0           MOVX    A,@DPTR
   \   0000BF   F9           MOV     R1,A
   \   0000C0   12....       LCALL   ??osal_start_timerEx?relay
    323          
    324              // return unprocessed events
    325              return (events ^ SAMPLEAPP_SEND_PERIODIC_MSG_EVT);
   \   0000C3   7401         MOV     A,#0x1
   \   0000C5   6E           XRL     A,R6
   \   0000C6   FA           MOV     R2,A
   \   0000C7   EF           MOV     A,R7
   \   0000C8   80D2         SJMP    ??SampleApp_ProcessEvent_10
    326            }
    327          
    328            // Discard unknown events
    329            return 0;
   \                     ??SampleApp_ProcessEvent_12:
   \   0000CA   7A00         MOV     R2,#0x0
   \   0000CC   7B00         MOV     R3,#0x0
   \                     ??SampleApp_ProcessEvent_11:
   \   0000CE   7F04         MOV     R7,#0x4
   \   0000D0   02....       LJMP    ?BANKED_LEAVE_XDATA
    330          }
    331          
    332          /*********************************************************************
    333           * Event Generation Functions
    334           */
    335          /*********************************************************************
    336           * @fn      SampleApp_HandleKeys
    337           *
    338           * @brief   Handles all key events for this device.
    339           *
    340           * @param   shift - true if in shift/alt.
    341           * @param   keys - bit field for key events. Valid entries:
    342           *                 HAL_KEY_SW_2
    343           *                 HAL_KEY_SW_1
    344           *
    345           * @return  none
    346           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    347          void SampleApp_HandleKeys( uint8 shift, uint8 keys )
   \                     SampleApp_HandleKeys:
    348          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
    349            (void)shift;  // Intentionally unreferenced parameter
    350            
    351            if ( keys & HAL_KEY_SW_1 )
   \   000007   A2E0         MOV     C,0xE0 /* A   */.0
   \   000009   5007         JNC     ??SampleApp_HandleKeys_0
    352            {
    353              /* This key sends the Flash Command is sent to Group 1.
    354               * This device will not receive the Flash Command from this
    355               * device (even if it belongs to group 1).
    356               */
    357              SampleApp_SendFlashMessage( SAMPLEAPP_FLASH_DURATION );
   \   00000B                ; Setup parameters for call to function SampleApp_SendFlashMessage
   \   00000B   7AE8         MOV     R2,#-0x18
   \   00000D   7B03         MOV     R3,#0x3
   \   00000F   12....       LCALL   ??SampleApp_SendFlashMessage?relay
    358            }
    359          
    360            if ( keys & HAL_KEY_SW_2 )
   \                     ??SampleApp_HandleKeys_0:
   \   000012   EE           MOV     A,R6
   \   000013   A2E1         MOV     C,0xE0 /* A   */.1
   \   000015   5023         JNC     ??SampleApp_HandleKeys_1
    361            {
    362              /* The Flashr Command is sent to Group 1.
    363               * This key toggles this device in and out of group 1.
    364               * If this device doesn't belong to group 1, this application
    365               * will not receive the Flash command sent to group 1.
    366               */
    367              aps_Group_t *grp;
    368              grp = aps_FindGroup( SAMPLEAPP_ENDPOINT, SAMPLEAPP_FLASH_GROUP );
    369              if ( grp )
   \   000017                ; Setup parameters for call to function aps_FindGroup
   \   000017   7A01         MOV     R2,#0x1
   \   000019   7B00         MOV     R3,#0x0
   \   00001B   7914         MOV     R1,#0x14
   \   00001D   12....       LCALL   ??aps_FindGroup?relay
   \   000020   EA           MOV     A,R2
   \   000021   7001         JNZ     ??SampleApp_HandleKeys_2
   \   000023   EB           MOV     A,R3
   \                     ??SampleApp_HandleKeys_2:
   \   000024   600B         JZ      ??SampleApp_HandleKeys_3
    370              {
    371                // Remove from the group
    372                aps_RemoveGroup( SAMPLEAPP_ENDPOINT, SAMPLEAPP_FLASH_GROUP );
   \   000026                ; Setup parameters for call to function aps_RemoveGroup
   \   000026   7A01         MOV     R2,#0x1
   \   000028   7B00         MOV     R3,#0x0
   \   00002A   7914         MOV     R1,#0x14
   \   00002C   12....       LCALL   ??aps_RemoveGroup?relay
   \   00002F   8009         SJMP    ??SampleApp_HandleKeys_1
    373              }
    374              else
    375              {
    376                // Add to the flash group
    377                aps_AddGroup( SAMPLEAPP_ENDPOINT, &SampleApp_Group );
   \                     ??SampleApp_HandleKeys_3:
   \   000031                ; Setup parameters for call to function aps_AddGroup
   \   000031   7A..         MOV     R2,#(SampleApp_Group & 0xff)
   \   000033   7B..         MOV     R3,#((SampleApp_Group >> 8) & 0xff)
   \   000035   7914         MOV     R1,#0x14
   \   000037   12....       LCALL   ??aps_AddGroup?relay
    378              }
    379            }
    380          }
   \                     ??SampleApp_HandleKeys_1:
   \   00003A   80..         SJMP    ??Subroutine1_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine1_0:
   \   000000   7F02         MOV     R7,#0x2
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA
    381          
    382          /*********************************************************************
    383           * LOCAL FUNCTIONS
    384           */
    385          
    386          /*********************************************************************
    387           * @fn      SampleApp_MessageMSGCB
    388           *
    389           * @brief   Data message processor callback.  This function processes
    390           *          any incoming data - probably from other devices.  So, based
    391           *          on cluster ID, perform the intended action.
    392           *
    393           * @param   none
    394           *
    395           * @return  none
    396           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    397          void SampleApp_MessageMSGCB( afIncomingMSGPacket_t *pkt )
   \                     SampleApp_MessageMSGCB:
    398          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
    399            uint16 flashTime;
    400          
    401            switch ( pkt->clusterId )
   \   000005   8A82         MOV     DPL,R2
   \   000007   8B83         MOV     DPH,R3
   \   000009   A3           INC     DPTR
   \   00000A   A3           INC     DPTR
   \   00000B   A3           INC     DPTR
   \   00000C   A3           INC     DPTR
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   F5..         MOV     ?V0 + 0,A
   \   000010   A3           INC     DPTR
   \   000011   E0           MOVX    A,@DPTR
   \   000012   F5..         MOV     ?V0 + 1,A
   \   000014   78..         MOV     R0,#?V0 + 0
   \   000016   12....       LCALL   ?US_SWITCH_DENSE
   \                     `?<Jumptable for SampleApp_MessageMSGCB>_0`:
   \   000019   0100         DW        1
   \   00001B   01           DB        1
   \   00001C   ....         DW        ??SampleApp_MessageMSGCB_0
   \   00001E   ....         DW        ??SampleApp_MessageMSGCB_0
   \   000020   ....         DW        ??SampleApp_MessageMSGCB_1
    402            {
    403              case SAMPLEAPP_PERIODIC_CLUSTERID:
    404                break;
    405          
    406              case SAMPLEAPP_FLASH_CLUSTERID:
    407                flashTime = BUILD_UINT16(pkt->cmd.Data[1], pkt->cmd.Data[2] );
    408                HalLedBlink( HAL_LED_4, 4, 50, (flashTime / 4) );
   \                     ??SampleApp_MessageMSGCB_1:
   \   000022   EA           MOV     A,R2
   \   000023   2421         ADD     A,#0x21
   \   000025   F582         MOV     DPL,A
   \   000027   EB           MOV     A,R3
   \   000028   3400         ADDC    A,#0x0
   \   00002A   F583         MOV     DPH,A
   \   00002C   E0           MOVX    A,@DPTR
   \   00002D   F8           MOV     R0,A
   \   00002E   A3           INC     DPTR
   \   00002F   E0           MOVX    A,@DPTR
   \   000030   F9           MOV     R1,A
   \   000031                ; Setup parameters for call to function HalLedBlink
   \   000031   8882         MOV     DPL,R0
   \   000033   8983         MOV     DPH,R1
   \   000035   A3           INC     DPTR
   \   000036   E0           MOVX    A,@DPTR
   \   000037   FA           MOV     R2,A
   \   000038   8882         MOV     DPL,R0
   \   00003A   8983         MOV     DPH,R1
   \   00003C   A3           INC     DPTR
   \   00003D   A3           INC     DPTR
   \   00003E   E0           MOVX    A,@DPTR
   \   00003F   F9           MOV     R1,A
   \   000040   EA           MOV     A,R2
   \   000041   F5..         MOV     ?V0 + 0,A
   \   000043   E9           MOV     A,R1
   \   000044   F5..         MOV     ?V0 + 1,A
   \   000046   7402         MOV     A,#0x2
   \   000048   78..         MOV     R0,#?V0 + 0
   \   00004A   12....       LCALL   ?US_SHR
   \   00004D   AC..         MOV     R4,?V0 + 0
   \   00004F   AD..         MOV     R5,?V0 + 1
   \   000051   7B32         MOV     R3,#0x32
   \   000053   7A04         MOV     R2,#0x4
   \   000055   7908         MOV     R1,#0x8
   \   000057   12....       LCALL   ??HalLedBlink?relay
    409                break;
    410            }
    411          }
   \                     ??SampleApp_MessageMSGCB_0:
   \   00005A   80..         SJMP    ??Subroutine1_0
    412          
    413          /*********************************************************************
    414           * @fn      SampleApp_SendPeriodicMessage
    415           *
    416           * @brief   Send the periodic message.
    417           *
    418           * @param   none
    419           *
    420           * @return  none
    421           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   12....       LCALL   ?DEALLOC_XSTACK8
   \   000003                REQUIRE ??Subroutine1_0
   \   000003                ; // Fall through to label ??Subroutine1_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    422          void SampleApp_SendPeriodicMessage( void )
   \                     SampleApp_SendPeriodicMessage:
    423          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
    424            if ( AF_DataRequest( &SampleApp_Periodic_DstAddr, &SampleApp_epDesc,
    425                                 SAMPLEAPP_PERIODIC_CLUSTERID,
    426                                 1,
    427                                 (uint8*)&SampleAppPeriodicCounter,
    428                                 &SampleApp_TransID,
    429                                 AF_DISCV_ROUTE,
    430                                 AF_DEFAULT_RADIUS ) == afStatus_SUCCESS )
   \   000005                ; Setup parameters for call to function AF_DataRequest
   \   000005   75..1E       MOV     ?V0 + 0,#0x1e
   \   000008   78..         MOV     R0,#?V0 + 0
   \   00000A   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   00000D   75....       MOV     ?V0 + 0,#(SampleApp_TransID & 0xff)
   \   000010   75....       MOV     ?V0 + 1,#((SampleApp_TransID >> 8) & 0xff)
   \   000013   78..         MOV     R0,#?V0 + 0
   \   000015   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000018   75....       MOV     ?V0 + 0,#(SampleAppPeriodicCounter & 0xff)
   \   00001B   75....       MOV     ?V0 + 1,#((SampleAppPeriodicCounter >> 8) & 0xff)
   \   00001E   78..         MOV     R0,#?V0 + 0
   \   000020   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000023   75..01       MOV     ?V0 + 0,#0x1
   \   000026   75..00       MOV     ?V0 + 1,#0x0
   \   000029   78..         MOV     R0,#?V0 + 0
   \   00002B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00002E   78..         MOV     R0,#?V0 + 0
   \   000030   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000033   7920         MOV     R1,#0x20
   \   000035   7C..         MOV     R4,#(SampleApp_epDesc & 0xff)
   \   000037   7D..         MOV     R5,#((SampleApp_epDesc >> 8) & 0xff)
   \   000039   7A..         MOV     R2,#(SampleApp_Periodic_DstAddr & 0xff)
   \   00003B   7B..         MOV     R3,#((SampleApp_Periodic_DstAddr >> 8) & 0xff)
   \   00003D   12....       LCALL   ??AF_DataRequest?relay
   \   000040   7409         MOV     A,#0x9
   \   000042   02....       LJMP    ?Subroutine0 & 0xFFFF
    431            {
    432            }
    433            else
    434            {
    435              // Error occurred in request to send.
    436            }
    437          }
    438          
    439          /*********************************************************************
    440           * @fn      SampleApp_SendFlashMessage
    441           *
    442           * @brief   Send the flash message to group 1.
    443           *
    444           * @param   flashTime - in milliseconds
    445           *
    446           * @return  none
    447           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    448          void SampleApp_SendFlashMessage( uint16 flashTime )
   \                     SampleApp_SendFlashMessage:
    449          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 3
   \   000005   74FD         MOV     A,#-0x3
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    450            uint8 buffer[3];
    451            buffer[0] = (uint8)(SampleAppFlashCounter++);
   \   00000A   90....       MOV     DPTR,#SampleAppFlashCounter
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   85..82       MOV     DPL,?XSP + 0
   \   000011   85..83       MOV     DPH,?XSP + 1
   \   000014   F0           MOVX    @DPTR,A
   \   000015   90....       MOV     DPTR,#SampleAppFlashCounter
   \   000018   E0           MOVX    A,@DPTR
   \   000019   04           INC     A
   \   00001A   F0           MOVX    @DPTR,A
    452            buffer[1] = LO_UINT16( flashTime );
   \   00001B   7401         MOV     A,#0x1
   \   00001D   12....       LCALL   ?XSTACK_DISP0_8
   \   000020   EA           MOV     A,R2
   \   000021   F0           MOVX    @DPTR,A
    453            buffer[2] = HI_UINT16( flashTime );
   \   000022   7402         MOV     A,#0x2
   \   000024   12....       LCALL   ?XSTACK_DISP0_8
   \   000027   EB           MOV     A,R3
   \   000028   F0           MOVX    @DPTR,A
    454          
    455            if ( AF_DataRequest( &SampleApp_Flash_DstAddr, &SampleApp_epDesc,
    456                                 SAMPLEAPP_FLASH_CLUSTERID,
    457                                 3,
    458                                 buffer,
    459                                 &SampleApp_TransID,
    460                                 AF_DISCV_ROUTE,
    461                                 AF_DEFAULT_RADIUS ) == afStatus_SUCCESS )
   \   000029                ; Setup parameters for call to function AF_DataRequest
   \   000029   75..1E       MOV     ?V0 + 0,#0x1e
   \   00002C   78..         MOV     R0,#?V0 + 0
   \   00002E   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000031   75....       MOV     ?V0 + 0,#(SampleApp_TransID & 0xff)
   \   000034   75....       MOV     ?V0 + 1,#((SampleApp_TransID >> 8) & 0xff)
   \   000037   78..         MOV     R0,#?V0 + 0
   \   000039   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00003C   7403         MOV     A,#0x3
   \   00003E   12....       LCALL   ?XSTACK_DISP0_8
   \   000041   8582..       MOV     ?V0 + 0,DPL
   \   000044   8583..       MOV     ?V0 + 1,DPH
   \   000047   78..         MOV     R0,#?V0 + 0
   \   000049   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00004C   75..03       MOV     ?V0 + 0,#0x3
   \   00004F   75..00       MOV     ?V0 + 1,#0x0
   \   000052   78..         MOV     R0,#?V0 + 0
   \   000054   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000057   75..02       MOV     ?V0 + 0,#0x2
   \   00005A   78..         MOV     R0,#?V0 + 0
   \   00005C   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00005F   7920         MOV     R1,#0x20
   \   000061   7C..         MOV     R4,#(SampleApp_epDesc & 0xff)
   \   000063   7D..         MOV     R5,#((SampleApp_epDesc >> 8) & 0xff)
   \   000065   7A..         MOV     R2,#(SampleApp_Flash_DstAddr & 0xff)
   \   000067   7B..         MOV     R3,#((SampleApp_Flash_DstAddr >> 8) & 0xff)
   \   000069   12....       LCALL   ??AF_DataRequest?relay
   \   00006C   7409         MOV     A,#0x9
   \   00006E   12....       LCALL   ?DEALLOC_XSTACK8
    462            {
    463            }
    464            else
    465            {
    466              // Error occurred in request to send.
    467            }
    468          }
   \   000071   7403         MOV     A,#0x3
   \   000073   02....       LJMP    ?Subroutine0 & 0xFFFF

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SampleApp_Init?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SampleApp_Init

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SampleApp_ProcessEvent?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SampleApp_ProcessEvent

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SampleApp_HandleKeys?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SampleApp_HandleKeys

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SampleApp_MessageMSGCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SampleApp_MessageMSGCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SampleApp_SendPeriodicMessage?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SampleApp_SendPeriodicMessage

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SampleApp_SendFlashMessage?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SampleApp_SendFlashMessage

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "\\r\\n HEELO Waveshare\\r\\n">`:
   \   000000   0D0A2048     DB "\015\012 HEELO Waveshare\015\012"
   \            45454C4F
   \            20576176
   \            65736861
   \            72650D0A
   \            00      

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "Group 1">`:
   \   000000   47726F75     DB "Group 1"
   \            70203100

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "SampleApp">`:
   \   000000   53616D70     DB "SampleApp"
   \            6C654170
   \            7000    
    469          
    470          /*********************************************************************
    471          *********************************************************************/

   Maximum stack usage in bytes:

     Function                       ISTACK PSTACK XSTACK
     --------                       ------ ------ ------
     SampleApp_HandleKeys               0      0     22
       -> SampleApp_SendFlashMessage
                                        0      0     20
       -> aps_FindGroup                 0      0     20
       -> aps_RemoveGroup               0      0     20
       -> aps_AddGroup                  0      0     20
     SampleApp_Init                     0      0     14
       -> HalUARTInit                   0      0     22
       -> printf                        0      0     22
       -> afRegister                    0      0     22
       -> RegisterForKeys               0      0     22
       -> osal_memcpy                   0      0     28
       -> aps_AddGroup                  0      0     22
       -> HalLcdWriteString             0      0     22
     SampleApp_MessageMSGCB             0      0     22
       -> HalLedBlink                   0      0     20
     SampleApp_ProcessEvent             0      0     12
       -> osal_msg_receive              0      0     24
       -> SampleApp_HandleKeys          0      0     24
       -> osal_msg_deallocate           0      0     24
       -> osal_msg_receive              0      0     24
       -> SampleApp_MessageMSGCB        0      0     24
       -> osal_start_timerEx            0      0     24
       -> SampleApp_SendPeriodicMessage
                                        0      0     24
       -> osal_rand                     0      0     24
       -> osal_start_timerEx            0      0     24
     SampleApp_SendFlashMessage         1      0     32
       -> AF_DataRequest                0      0     44
     SampleApp_SendPeriodicMessage      0      0     31
       -> AF_DataRequest                0      0     38


   Segment part sizes:

     Function/Label                         Bytes
     --------------                         -----
     SampleApp_ClusterList                     4
     SampleApp_SimpleDesc                     12
     SampleApp_epDesc                          6
     SampleApp_TaskID                          1
     SampleApp_NwkState                        1
     SampleApp_TransID                         1
     SampleApp_Periodic_DstAddr               12
     SampleApp_Flash_DstAddr                  12
     SampleApp_Group                          18
     SampleAppPeriodicCounter                  1
     SampleAppFlashCounter                     1
     SampleApp_Init                          179
     SampleApp_ProcessEvent                  211
     SampleApp_HandleKeys                     60
     ??Subroutine1_0                           5
     SampleApp_MessageMSGCB                   92
     ?Subroutine0                              3
     SampleApp_SendPeriodicMessage            69
     SampleApp_SendFlashMessage              118
     ??SampleApp_Init?relay                    6
     ??SampleApp_ProcessEvent?relay            6
     ??SampleApp_HandleKeys?relay              6
     ??SampleApp_MessageMSGCB?relay            6
     ??SampleApp_SendPeriodicMessage?relay     6
     ??SampleApp_SendFlashMessage?relay        6
     ?<Constant "\r\n HEELO Waveshare\r\n">   21
     ?<Constant "Group 1">                     8
     ?<Constant "SampleApp">                  10

 
 737 bytes in segment BANKED_CODE
  36 bytes in segment BANK_RELAYS
  55 bytes in segment XDATA_ROM_C
  53 bytes in segment XDATA_Z
 
 773 bytes of CODE  memory
  55 bytes of CONST memory
  53 bytes of XDATA memory

Errors: none
Warnings: none
